@model MoviesDashboard.ViewModels.EditMovieVM

@{
	ViewData["Title"] = "Edit Movie";
}

<h3>Edit Movie</h3>

<form asp-action="Edit" method="post" enctype="multipart/form-data">
	<input type="hidden" asp-for="Id" />

	<div class="row g-3">
		<div class="col-md-6">
			<label asp-for="Name" class="form-label">Movie Name</label>
			<input asp-for="Name" class="form-control" />
			<span asp-validation-for="Name" class="text-danger"></span>
		</div>

		<div class="col-md-6">
			<label asp-for="Descrption" class="form-label"></label>
			<textarea asp-for="Descrption" class="form-control"></textarea>
		</div>

		<div class="col-md-6">
			<label asp-for="Price" class="form-label">Price</label>
			<input asp-for="Price" class="form-control" />
			<span asp-validation-for="Price" class="text-danger"></span>
		</div>

		<div class="col-md-4">
			<label asp-for="Status" class="form-label"></label>
			<select asp-for="Status" class="form-select">
				<option value="true">Active</option>
				<option value="false">Inactive</option>
			</select>
		</div>

		<div class="col-md-4">
			<label asp-for="Date" class="form-label"></label>
			<input asp-for="Date" type="date" class="form-control" />
		</div>

		<div class="col-md-4">
			<label asp-for="Time" class="form-label"></label>
			<input asp-for="Time" type="time" class="form-control" />
		</div>

		<div class="col-md-4">
			<label asp-for="CategoryId" class="form-label">Category</label>
			<select asp-for="CategoryId" asp-items="Model.Categories" class="form-select">
				<option value="">-- Select --</option>
			</select>
			<span asp-validation-for="CategoryId" class="text-danger"></span>
		</div>

		<div class="col-md-4">
			<label asp-for="CinemaId" class="form-label">Cinema</label>
			<select asp-for="CinemaId" asp-items="Model.Cinemas" class="form-select">
				<option value="">-- Select --</option>
			</select>
			<span asp-validation-for="CinemaId" class="text-danger"></span>
		</div>

		<div class="col-md-4">
			<label class="form-label">Current Main Image</label>
			@if (!string.IsNullOrEmpty(Model.MainImg))
			{
				<div>
					<img src="~/images/movies/@Model.MainImg" alt="@Model.Name" width="150" class="img-thumbnail" />
				</div>
			}
			<label asp-for="MainImageFile" class="form-label mt-2">Replace Main Image</label>
			<input asp-for="MainImageFile" type="file" class="form-control" />
			<span asp-validation-for="MainImageFile" class="text-danger"></span>
		</div>

		<div class="col-12">
			<label class="form-label">Current Sub Images</label>
			<div class="d-flex flex-wrap gap-3">
				@if (Model.SubImages != null && Model.SubImages.Any())
				{
					foreach (var si in Model.SubImages)
					{
						<div class="position-relative" style="width:120px">
							<img src="~/images/movies/@si.ImageUrl" class="img-thumbnail" style="width:120px; height:120px; object-fit:cover" />
							<a asp-action="DeleteImage"
							   asp-route-movieId="@Model.Id"
							   asp-route-imageUrl="@si.ImageUrl"
							   class="btn btn-sm btn-danger position-absolute top-0 end-0"
							   title="Delete">
								×
							</a>
						</div>
					}
				}
				else
				{
					<div>No sub images.</div>
				}
			</div>
		</div>

		<div class="col-12">
			<label class="form-label">Add New Sub Images</label>
			<input asp-for="NewSubImages" type="file" multiple class="form-control" name="NewSubImages" />
			<small class="text-muted">You can upload multiple images. Existing images won't be removed unless you delete them.</small>
		</div>
	</div>

	<div class="mt-4">
		<button type="submit" class="btn btn-primary">Save</button>
		<a asp-action="Index" class="btn btn-secondary ms-2">Cancel</a>
	</div>
</form>

@section Scripts {
	<partial name="_ValidationScriptsPartial" />
}
